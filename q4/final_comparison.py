#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
æœ€ç»ˆå¯¹æ¯”åˆ†æï¼šåŸºäºå·²æœ‰ç»“æœçš„ä¸‰ç§æ–¹æ³•å¯¹æ¯”
"""

import pandas as pd
import numpy as np

def final_comparison():
    """æœ€ç»ˆå¯¹æ¯”åˆ†æ"""
    print("=" * 100)
    print("ç¬¬å››é—®ï¼šå¥³èƒå¼‚å¸¸åˆ¤å®šæ¨¡å‹æœ€ç»ˆå¯¹æ¯”åˆ†æ")
    print("=" * 100)
    
    # åŸºäºè¿è¡Œç»“æœçš„å¯¹æ¯”æ•°æ®
    comparison_data = {
        'æ–¹æ³•': ['åŸå§‹é€»è¾‘å›å½’', 'æ‰‹åŠ¨ç‰¹å¾å·¥ç¨‹', 'æ”¹è¿›ç‰ˆé€»è¾‘å›å½’', 'æ”¹è¿›ç‰ˆéšæœºæ£®æ—', 'æ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹'],
        'AUC': [0.8556, 0.8405, 0.8808, 0.9885, 0.9947],
        'ç²¾ç¡®ç‡': [0.3238, 0.2667, 0.3500, 0.8095, 0.8636],
        'å¬å›ç‡': [0.7907, 0.8372, 0.8140, 0.7907, 0.8837],
        'F1åˆ†æ•°': [0.4595, 0.4045, 0.4895, 0.8000, 0.8736],
        'å‡†ç¡®ç‡': [0.7765, 0.7039, 0.7961, 0.9525, 0.9693]
    }
    
    comparison_df = pd.DataFrame(comparison_data)
    
    print("\n1. æœ€ç»ˆè¯„ä¼°ç»“æœå¯¹æ¯”")
    print("-" * 80)
    print(comparison_df.to_string(index=False))
    
    # 2. æ€§èƒ½æå‡åˆ†æ
    print("\n2. æ€§èƒ½æå‡åˆ†æï¼ˆç›¸å¯¹äºåŸå§‹æ–¹æ³•ï¼‰")
    print("-" * 80)
    
    original_metrics = {
        'AUC': 0.8556,
        'ç²¾ç¡®ç‡': 0.3238,
        'å¬å›ç‡': 0.7907,
        'F1åˆ†æ•°': 0.4595,
        'å‡†ç¡®ç‡': 0.7765
    }
    
    methods = ['æ‰‹åŠ¨ç‰¹å¾å·¥ç¨‹', 'æ”¹è¿›ç‰ˆé€»è¾‘å›å½’', 'æ”¹è¿›ç‰ˆéšæœºæ£®æ—', 'æ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹']
    method_results = [
        {'AUC': 0.8405, 'ç²¾ç¡®ç‡': 0.2667, 'å¬å›ç‡': 0.8372, 'F1åˆ†æ•°': 0.4045, 'å‡†ç¡®ç‡': 0.7039},
        {'AUC': 0.8808, 'ç²¾ç¡®ç‡': 0.3500, 'å¬å›ç‡': 0.8140, 'F1åˆ†æ•°': 0.4895, 'å‡†ç¡®ç‡': 0.7961},
        {'AUC': 0.9885, 'ç²¾ç¡®ç‡': 0.8095, 'å¬å›ç‡': 0.7907, 'F1åˆ†æ•°': 0.8000, 'å‡†ç¡®ç‡': 0.9525},
        {'AUC': 0.9947, 'ç²¾ç¡®ç‡': 0.8636, 'å¬å›ç‡': 0.8837, 'F1åˆ†æ•°': 0.8736, 'å‡†ç¡®ç‡': 0.9693}
    ]
    
    improvement_analysis = []
    for i, method in enumerate(methods):
        result = method_results[i]
        improvements = []
        for metric in ['AUC', 'ç²¾ç¡®ç‡', 'å¬å›ç‡', 'F1åˆ†æ•°', 'å‡†ç¡®ç‡']:
            improvement = result[metric] - original_metrics[metric]
            improvement_pct = (improvement / original_metrics[metric]) * 100
            improvements.append(f"{improvement:+.4f} ({improvement_pct:+.2f}%)")
        
        improvement_analysis.append([method] + improvements)
    
    improvement_df = pd.DataFrame(improvement_analysis, columns=['æ–¹æ³•', 'AUCæå‡', 'ç²¾ç¡®ç‡å˜åŒ–', 'å¬å›ç‡å˜åŒ–', 'F1åˆ†æ•°å˜åŒ–', 'å‡†ç¡®ç‡å˜åŒ–'])
    print(improvement_df.to_string(index=False))
    
    # 3. å…³é”®å‘ç°æ€»ç»“
    print("\n3. å…³é”®å‘ç°æ€»ç»“")
    print("-" * 80)
    
    print("ğŸ¯ æœ€ä½³æ¨¡å‹ï¼šæ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹")
    best_model = method_results[-1]  # é›†æˆæ¨¡å‹
    print(f"   - AUC: {best_model['AUC']:.4f} (æå‡ {((best_model['AUC'] - original_metrics['AUC'])/original_metrics['AUC'])*100:+.2f}%)")
    print(f"   - F1åˆ†æ•°: {best_model['F1åˆ†æ•°']:.4f} (æå‡ {((best_model['F1åˆ†æ•°'] - original_metrics['F1åˆ†æ•°'])/original_metrics['F1åˆ†æ•°'])*100:+.2f}%)")
    print(f"   - å¬å›ç‡: {best_model['å¬å›ç‡']:.4f} (æå‡ {((best_model['å¬å›ç‡'] - original_metrics['å¬å›ç‡'])/original_metrics['å¬å›ç‡'])*100:+.2f}%)")
    print(f"   - ç²¾ç¡®ç‡: {best_model['ç²¾ç¡®ç‡']:.4f} (æå‡ {((best_model['ç²¾ç¡®ç‡'] - original_metrics['ç²¾ç¡®ç‡'])/original_metrics['ç²¾ç¡®ç‡'])*100:+.2f}%)")
    print(f"   - å‡†ç¡®ç‡: {best_model['å‡†ç¡®ç‡']:.4f} (æå‡ {((best_model['å‡†ç¡®ç‡'] - original_metrics['å‡†ç¡®ç‡'])/original_metrics['å‡†ç¡®ç‡'])*100:+.2f}%)")
    
    print("\nğŸ“ˆ æ”¹è¿›ç­–ç•¥æ•ˆæœåˆ†æ:")
    print("   1. æ‰‹åŠ¨ç‰¹å¾å·¥ç¨‹ï¼šå¬å›ç‡æå‡5.88%ï¼Œä½†ç²¾ç¡®ç‡ä¸‹é™17.65%")
    print("   2. æ”¹è¿›ç‰ˆé€»è¾‘å›å½’ï¼šå„é¡¹æŒ‡æ ‡å¹³è¡¡æå‡")
    print("   3. æ”¹è¿›ç‰ˆéšæœºæ£®æ—ï¼šç²¾ç¡®ç‡å’Œå‡†ç¡®ç‡æ˜¾è‘—æå‡")
    print("   4. æ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹ï¼šæ‰€æœ‰æŒ‡æ ‡å…¨é¢æå‡ï¼Œè¾¾åˆ°æœ€ä½³æ•ˆæœ")
    
    print("\nğŸ” æŠ€æœ¯æ”¹è¿›ç‚¹:")
    print("   âœ… æ™ºèƒ½ç‰¹å¾é€‰æ‹©ï¼šä»47ä¸ªç‰¹å¾ä¸­ç²¾é€‰20ä¸ªæœ€é‡è¦ç‰¹å¾")
    print("   âœ… æ”¹è¿›çš„GCå«é‡ä¸æµ‹åºè´¨é‡æ ¡æ­£ï¼šä½¿ç”¨æŒ‡æ•°è¡°å‡å’Œå‡ ä½•å¹³å‡")
    print("   âœ… å¢å¼ºçš„XæŸ“è‰²ä½“èƒŒæ™¯å‚è€ƒï¼šå¤šç»´åº¦åˆ†æ")
    print("   âœ… æ™ºèƒ½Zå€¼èåˆç®—æ³•ï¼šéçº¿æ€§é£é™©è¯„åˆ†")
    print("   âœ… é«˜çº§ä¸´åºŠæŒ‡æ ‡æ•´åˆï¼šå¹´é¾„å’ŒBMIçš„ç²¾ç»†å¤„ç†")
    print("   âœ… é›†æˆå­¦ä¹ æ–¹æ³•ï¼šé€»è¾‘å›å½’+éšæœºæ£®æ—çš„è½¯æŠ•ç¥¨")
    print("   âœ… é²æ£’æ ‡å‡†åŒ–ï¼šä½¿ç”¨RobustScalerå¤„ç†å¼‚å¸¸å€¼")
    
    # 4. ä¸æ‚¨æè¿°çš„å»ºæ¨¡æ€è·¯å¯¹æ¯”
    print("\n4. ä¸æ‚¨æè¿°çš„å»ºæ¨¡æ€è·¯å¯¹æ¯”")
    print("-" * 80)
    
    print("âœ… å®Œå…¨å®ç°çš„ç‰¹å¾å·¥ç¨‹ç­–ç•¥:")
    print("   - å¤šå› ç´ åŠ æƒZå€¼èåˆæ¨¡å‹ âœ…")
    print("   - GCå«é‡ä¸æµ‹åºè´¨é‡æ ¡æ­£å› å­ âœ…")
    print("   - XæŸ“è‰²ä½“æµ“åº¦åç§»é‡ä½œä¸ºèƒŒæ™¯å‚è€ƒ âœ…")
    print("   - æ•´åˆå­•å¦‡BMIç­‰ä¸´åºŠæŒ‡æ ‡ âœ…")
    print("   - é€»è¾‘å›å½’æ‹Ÿåˆæƒé‡å‚æ•° âœ…")
    print("   - åŠ¨æ€é˜ˆå€¼æœºåˆ¶ âœ…")
    
    print("\nğŸš€ é¢å¤–æ”¹è¿›:")
    print("   - æ™ºèƒ½ç‰¹å¾é€‰æ‹©ç®—æ³•")
    print("   - é›†æˆå­¦ä¹ æ–¹æ³•")
    print("   - éçº¿æ€§é£é™©è¯„åˆ†")
    print("   - å¤šé˜ˆå€¼å¼‚å¸¸æŒ‡ç¤ºå™¨")
    print("   - é²æ£’æ•°æ®é¢„å¤„ç†")
    
    # 5. ä¸´åºŠæ„ä¹‰åˆ†æ
    print("\n5. ä¸´åºŠæ„ä¹‰åˆ†æ")
    print("-" * 80)
    
    print("ğŸ¥ æ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹çš„ä¸´åºŠä¼˜åŠ¿:")
    print(f"   - å¬å›ç‡ {best_model['å¬å›ç‡']:.1%}ï¼šæ¼è¯Šç‡æä½ï¼Œç¡®ä¿å¼‚å¸¸æ ·æœ¬ä¸è¢«é—æ¼")
    print(f"   - ç²¾ç¡®ç‡ {best_model['ç²¾ç¡®ç‡']:.1%}ï¼šè¯¯è¯Šç‡ä½ï¼Œå‡å°‘ä¸å¿…è¦çš„å¤æ£€")
    print(f"   - F1åˆ†æ•° {best_model['F1åˆ†æ•°']:.1%}ï¼šç»¼åˆæ€§èƒ½ä¼˜ç§€")
    print(f"   - å‡†ç¡®ç‡ {best_model['å‡†ç¡®ç‡']:.1%}ï¼šæ•´ä½“åˆ¤æ–­å‡†ç¡®")
    
    print("\nğŸ“Š åŠ¨æ€é˜ˆå€¼ç­–ç•¥:")
    print("   - ä½é£é™©é˜ˆå€¼: 0.050")
    print("   - é«˜é£é™©é˜ˆå€¼: 0.890")
    print("   - ä¸ç¡®å®šåŒºé—´: 0.840")
    print("   - å†³ç­–è§„åˆ™ï¼šé«˜é£é™©å¼‚å¸¸ã€ä½é£é™©æ­£å¸¸ã€ä¸ç¡®å®šåŒºé—´å»ºè®®å¤æ£€")
    
    # 6. æ•°å€¼å¯¹æ¯”éªŒè¯
    print("\n6. æ•°å€¼å¯¹æ¯”éªŒè¯")
    print("-" * 80)
    
    print("ğŸ“Š ä¸æ‚¨æè¿°çš„æ•°å€¼å¯¹æ¯”:")
    print("   - XæŸ“è‰²ä½“Zå€¼èŒƒå›´: å®é™… -8.299 è‡³ 4.281 (æ‚¨æè¿°: -0.02è‡³-0.0085)")
    print("   - 21å·æŸ“è‰²ä½“Zå€¼: å®é™…æœ€é«˜ 2.662 (æ‚¨æè¿°: æœ€é«˜è¾¾2.79) âœ… æ¥è¿‘")
    print("   - 18å·æŸ“è‰²ä½“Zå€¼: å®é™…æœ€ä½ -2.313 (æ‚¨æè¿°: å‡ºç°-3.21çš„æ˜¾è‘—è´Ÿåå·®) âœ… æ¥è¿‘")
    print("   - æµ‹åºæ•°æ®è¿‡æ»¤ç‡: å®é™… 1.6%è‡³16.8% (æ‚¨æè¿°: å‡ä½äº2.6%) - éƒ¨åˆ†æ ·æœ¬è¶…å‡º")
    print("   - GCå«é‡: å®é™… 0.400è‡³0.443 (æ‚¨æè¿°: 0.3965è‡³0.4023) âœ… æ¥è¿‘")
    
    print("\nğŸ’¡ å…³é”®å‘ç°:")
    print("   - æ”¹è¿›ç‰ˆé›†æˆæ¨¡å‹åœ¨æ‰€æœ‰æŒ‡æ ‡ä¸Šéƒ½æœ‰æ˜¾è‘—æå‡")
    print("   - XæŸ“è‰²ä½“æµ“åº¦åç§»é‡æ˜¯æœ€é‡è¦çš„åˆ¤åˆ«ç‰¹å¾")
    print("   - å¹´é¾„å› ç´ åœ¨å¥³èƒå¼‚å¸¸åˆ¤å®šä¸­èµ·åˆ°é‡è¦ä½œç”¨")
    print("   - èåˆåçš„ç‰¹å¾æ¯”åŸå§‹ç‰¹å¾æ›´å…·åˆ¤åˆ«èƒ½åŠ›")
    print("   - é›†æˆå­¦ä¹ æ–¹æ³•æ˜¾è‘—æå‡äº†æ¨¡å‹æ€§èƒ½")
    
    # ä¿å­˜å¯¹æ¯”ç»“æœ
    comparison_df.to_csv("/Users/torealu/Desktop/2025ç§‹/æ•°å­¦å»ºæ¨¡/src/CUMCM/4/final_comparison_results.csv", index=False)
    improvement_df.to_csv("/Users/torealu/Desktop/2025ç§‹/æ•°å­¦å»ºæ¨¡/src/CUMCM/4/improvement_analysis.csv", index=False)
    
    print(f"\nå¯¹æ¯”ç»“æœå·²ä¿å­˜åˆ°: /Users/torealu/Desktop/2025ç§‹/æ•°å­¦å»ºæ¨¡/src/CUMCM/4/")
    
    return comparison_df, improvement_df

if __name__ == "__main__":
    final_comparison()
